{% parse_json request_object %}
{
  "template": "modules/core/generic",
  "data": {
    "to": "https://api.openai.com/v1/embeddings",
    "headers": {
      "Content-Type": "application/json",
      "Authorization": "Bearer {{ context.constants['modules/openai/OPENAI_SECRET_TOKEN'] }}"
    },
    "request_type": "POST",
    "payload": { "model": "text-embedding-ada-002" }
  }
}
{% endparse_json %}

{% liquid

  assign obj_type = object | type_of
  if obj_type != 'Array'
    assign arr = '[]' | parse_json | add_to_array: object
  else
    assign arr = object
  endif
  hash_assign request_object['data']['payload']['input'] = arr | compact

  return request_object
%}
